SELECT
	COUNT(SGS.GYOUSYA_CODE)
FROM
	(
		SELECT
			GYOUSYA_CODE,
			GROUP_CONCAT(SAI.SAIMOKU_KOUSYU_NAME) AS SAIMOKU_NAME_LIST
		FROM
			M_GYOUSYA_SAIMOKU MGS
		LEFT JOIN M_SAIMOKU_KOUSYU SAI ON MGS.SAIMOKU_KOUSYU_CODE = SAI.SAIMOKU_KOUSYU_CODE
		WHERE
			GYOUSYA_CODE IN (
				SELECT
					GYOUSYA_CODE
				FROM
					M_GYOUSYA_SAIMOKU
				WHERE
					GYOUSYA_CODE IS NOT NULL
				/*%if saimokuKousyuCode != null && saimokuKousyuCode != ""*/
					AND SAIMOKU_KOUSYU_CODE = /*saimokuKousyuCode*/1
				/*%end*/
			)
		GROUP BY
			GYOUSYA_CODE
	) SGS
LEFT OUTER JOIN M_GYOUSYA GYO ON SGS.GYOUSYA_CODE = GYO.GYOUSYA_CODE
LEFT OUTER JOIN T_GYOUSYA_ACCOUNT TGA ON SGS.GYOUSYA_CODE = TGA.GYOUSYA_CODE
WHERE
	GYO.GYOUSYA_NAME IS NOT NULL
/*%if gyousyaName != null && gyousyaName != ""*/
AND GYO.GYOUSYA_NAME LIKE /*@infix(gyousyaName)*/'smith' escape '$'
/*%end*/
/*%if registKbn == "1"*/
AND TGA.GYOUSYA_CODE IS NULL
/*%elseif registKbn == "2"*/
AND TGA.GYOUSYA_CODE IS NOT NULL
/*%elseif registKbn == "3"*/
/*%end*/
;
